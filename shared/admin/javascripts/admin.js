!function(){var t;t=angular.module("adminApp",["ngCookies"]),t.controller("AdminIndexCtrl",["$scope","$location","$q","$cookieStore",function(t,e,n,r){return t.host=e.search().host||r.get("host")||e.host(),t.port=e.search().port||r.get("port"),t.database=e.search().database||r.get("database"),t.username=e.search().username||r.get("username"),t.password=e.search().password||r.get("password"),t.ssl=r.get("ssl")||!1,t.authenticated=!1,t.isClusterAdmin=!1,t.databases=[],t.admins=[],t.data=[],t.readQuery=null,t.writeSeriesName=null,t.writeValues=null,t.successMessage="OK",t.alertMessage="Error",t.authMessage="",t.queryMessage="",t.selectedPane="databases",t.selectedSubPane="users",t.newDbUser={},t.interfaces=[],t.databaseUsers=[],t.retentionPolicies=[],t.databaseUser=null,t.successMessage="",t.failureMessage="",t.newAdminUsername=null,t.newAdminPassword=null,t.newUserPassword=null,t.newUserPasswordConfirmation=null,window.influxdb=null,t.alertSuccess=function(e){return t.successMessage=e,$("#alert-success").show().delay(2500).fadeOut(500)},t.alertFailure=function(e){return t.failureMessage=e,$("#alert-failure").show().delay(2500).fadeOut(500)},t.humanize=function(t){return t.replace(/_/g," ").replace(/(\w+)/g,function(t){return t.charAt(0).toUpperCase()+t.slice(1)})},t.setCurrentInterface=function(e){return $("iframe").prop("src","/interfaces/"+e),t.selectedPane="data"},t.showDefaultInterface=function(e){return window.influxdb.database=e,$("iframe").prop("src","/interfaces/default"),t.selectedPane="data"},t.authenticateUser=function(){return t.database?t.authenticateAsDatabaseAdmin():t.authenticateAsClusterAdmin()},t.authenticateAsClusterAdmin=function(){return window.influxdb=new InfluxDB({hosts:[t.host],port:t.port,username:t.username,password:t.password,ssl:t.ssl}),t.authenticated=!0,t.isClusterAdmin=!0,t.isDatabaseAdmin=!1,t.selectedPane="databases",t.selectedSubPane="users",t.storeAuthenticatedCredentials(),t.getDatabases(),t.database?(t.selectedDatabase=t.database,t.showUsers()):void 0},t.authenticateAsDatabaseAdmin=function(){return window.influxdb=new InfluxDB({host:t.host,port:t.port,username:t.username,password:t.password,database:t.database,ssl:t.ssl}),t.authenticated=!0,t.isDatabaseAdmin=!0,t.isClusterAdmin=!1,t.selectedPane="databases",t.selectedSubPane="users",t.selectedDatabase=t.database,t.storeAuthenticatedCredentials(),t.showUsers()},t.storeAuthenticatedCredentials=function(){return r.put("username",t.username),r.put("password",t.password),r.put("database",t.database),r.put("host",t.host),r.put("port",t.port),r.put("ssl",t.ssl)},t.getDatabases=function(){return n.when(window.influxdb.showDatabases()).then(function(e){var n,r;return n=e.results[0],r=n.rows[0],t.databases=r.values.map(function(t){return{name:t[0]}})})},t.getUsers=function(){return n.when(window.influxdb.getUsers()).then(function(e){return t.users=e})},t.createDatabase=function(){return n.when(window.influxdb.createDatabase(t.newDatabaseName)).then(function(){return t.alertSuccess("Successfully created database: "+t.newDatabaseName),t.newDatabaseName=null,t.getDatabases()},function(e){return t.alertFailure("Failed to create database: "+e.responseText)})},t.deleteDatabase=function(e){return n.when(window.influxdb.dropDatabase(e)).then(function(){return t.alertSuccess("Successfully removed database: "+e),t.getDatabases()},function(e){return t.alertFailure("Failed to remove database: "+e.responseText)})},t.authError=function(e){return t.authMessage=e,$("span#authFailure").show().delay(1500).fadeOut(500)},t.error=function(e){return t.alertMessage=e,$("span#writeFailure").show().delay(1500).fadeOut(500)},t.success=function(e){return t.successMessage=e,$("span#writeSuccess").show().delay(1500).fadeOut(500)},t.filteredColumns=function(t){return t.columns.filter(function(t){return"time"!==t&&"sequence_number"!==t})},t.columnPoints=function(t,e){var n;return n=t.columns.indexOf(e),t.points.map(function(t){return{time:new Date(t[0]),value:t[n]}})},t.getDatabaseUsers=function(){return n.when(window.influxdb.showUsers()).then(function(e){var n,r;return n=e.results[0],r=n.rows[0],t.databaseUsers=r.values.map(function(t){return{name:t[0],isAdmin:t[1]}})})},t.getRetentionPolicies=function(){return n.when(window.influxdb.showRetentionPolicies(t.selectedDatabase)).then(function(e){var n,r;return n=e.results[0],r=n.rows[0],t.retentionPolicies=r.values?r.values.map(function(t){return{name:t[0],duration:t[1],replicaN:t[2]}}):[]})},t.createRetentionPolicy=function(){return n.when(window.influxdb.createRetentionPolicy(t.selectedDatabase,t.newRetentionPolicyName,t.newRetentionPolicyDuration,t.newRetentionPolicyReplication,t.newRetentionPolicyIsDefault)).then(function(){return t.alertSuccess("Successfully created retention policy: "+t.newRetentionPolicyName),t.newRetentionPolicyName=null,t.newRetentionPolicyDuration=null,t.newRetentionPolicyReplication=null,t.newRetentionPolicyIsDefault=!1,t.getRetentionPolicies()},function(e){return t.alertFailure("Failed to create retention policy: "+e.responseText)})},t.getDatabaseUser=function(){return n.when(window.influxdb.getDatabaseUser(t.selectedDatabase,t.selectedDatabaseUser)).then(function(e){return t.databaseUser=e})},t.showSelectedDatabase=function(){return t.selectedPane="databases",t.selectedSubPane="users",t.selectedDatabaseUser=null,t.getDatabaseUsers(),t.getRetentionPolicies()},t.showDatabases=function(){return t.getDatabases(),t.selectedPane="databases",t.selectedSubPane="users",t.selectedDatabase=null,t.selectedDatabaseUser=null},t.showDatabase=function(e){return t.selectedDatabase=e.name,t.selectedDatabaseUser=null,t.getDatabaseUsers()},t.showDatabaseUsers=function(){return t.selectedDatabaseUser=null,t.selectedSubPane="users",t.getDatabaseUsers()},t.getContinuousQueries=function(){return n.when(window.influxdb.getClusterConfiguration()).then(function(e){return t.continuousQueries=e.ContinuousQueries[t.selectedDatabase]})},t.showContinuousQueries=function(){return t.selectedDatabaseUser=null,t.selectedSubPane="continuousQueries",t.getContinuousQueries()},t.showRetentionPolicies=function(){return t.selectedDatabaseUser=null,t.selectedSubPane="retentionPolicies",t.getRetentionPolicies()},t.showDatabaseUser=function(e){return t.selectedDatabaseUser=e.name,t.getDatabaseUser()},t.changeDbUserPassword=function(){var e;return t.dbUserPassword!==t.dbUserPasswordConfirmation?t.alertFailure("Sorry, the passwords don't match."):null===t.dbUserPassword||""===t.dbUserPassword?t.alertFailure("Sorry, passwords cannot be blank."):(e={password:t.dbUserPassword},n.when(window.influxdb.updateDatabaseUser(t.selectedDatabase,t.selectedDatabaseUser,e)).then(function(){return t.alertSuccess("Successfully changed password for '"+t.selectedDatabaseUser+"'"),t.dbUserPassword=null,t.dbUserPasswordConfirmation=null},function(e){return t.alertFailure("Failed to change password for user: "+e.responseText)}))},t.changeClusterAdminPassword=function(){var e;return t.clusterAdminPassword!==t.clusterAdminPasswordConfirmation?t.alertFailure("Sorry, the passwords don't match."):null===t.clusterAdminPassword||""===t.clusterAdminPassword?t.alertFailure("Sorry, passwords cannot be blank."):(e={password:t.clusterAdminPassword},n.when(window.influxdb.updateClusterAdmin(t.selectedClusterAdmin,e)).then(function(){return t.alertSuccess("Successfully changed password for '"+t.selectedClusterAdmin+"'"),t.clusterAdminPassword=null,t.clusterAdminPasswordConfirmation=null},function(e){return t.alertFailure("Failed to change password for cluster admin: "+e.responseText)}))},t.updateDatabaseUser=function(){var e;return e={admin:t.databaseUser.isAdmin},n.when(window.influxdb.updateDatabaseUser(t.selectedDatabase,t.selectedDatabaseUser,e)).then(function(){return t.alertSuccess("Successfully updated database user '"+t.selectedDatabaseUser+"'"),t.getDatabaseUsers()},function(e){return t.alertFailure("Failed to update database user: "+e.responseText)})},t.deleteDatabaseUser=function(e){return n.when(window.influxdb.deleteDatabaseUser(t.selectedDatabase,e)).then(function(){return t.alertSuccess("Successfully delete user: "+e),t.getDatabaseUsers()},function(e){return t.alertFailure("Failed to delete user: "+e.responseText)})}}]),t.directive("ngConfirmClick",[function(){return{priority:-1,restrict:"A",link:function(t,e,n){return e.bind("click",function(t){var e;return e=n.ngConfirmClick,e&&!confirm(e)?(t.stopImmediatePropagation(),t.preventDefault()):void 0})}}}])}.call(this);