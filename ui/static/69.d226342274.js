(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{1760:function(e,t,a){"use strict";a.r(t);var n=a(11),s=a(2),r=a.n(s),i=a(4),o=a(3),l=a(12),c=a(117),u=a.n(c),d=a(249),g=a(350);let m=class extends s.PureComponent{constructor(e){super(e),this.handleSelectBucket=e=>{this.props.onSelectBucket(e)},this.handleToggle=e=>{this.props.onTogglePluginBundle(e,this.isCardChecked(e))},this.handleFilterChange=e=>{this.setState({searchTerm:e.target.value})},this.handleFilterBlur=e=>{this.setState({searchTerm:e.target.value})},this.state={gridSizerUpdateFlag:u.a.v4(),searchTerm:""}}componentDidUpdate(e){const t=0===e.telegrafPlugins.length&&this.props.telegrafPlugins.length>0,a=e.telegrafPlugins.length>0&&0===this.props.telegrafPlugins.length;if(t||a){const e=u.a.v4();this.setState({gridSizerUpdateFlag:e})}}render(){const{buckets:e}=this.props,{searchTerm:t}=this.state,a=`${100/(d.b.length+1)}%`;return r.a.createElement("div",{className:"wizard-step--grid-container"},r.a.createElement(o.Grid.Row,null,r.a.createElement(o.Grid.Column,{widthSM:o.Columns.Five},r.a.createElement(o.FormElement,{label:"Bucket"},r.a.createElement(g.a,{selectedBucketID:this.selectedBucketID,buckets:e,onSelectBucket:this.handleSelectBucket}))),r.a.createElement(o.Grid.Column,{widthSM:o.Columns.Five,offsetSM:o.Columns.Two},r.a.createElement(o.FormElement,{label:""},r.a.createElement(o.Input,{className:"wizard-step--filter",size:o.ComponentSize.Small,icon:o.IconFont.Search,value:t,onBlur:this.handleFilterBlur,onChange:this.handleFilterChange,placeholder:"Filter Plugins..."})))),r.a.createElement(o.SquareGrid,{cardSize:a,gutter:o.ComponentSize.Small},this.filteredBundles.map(e=>r.a.createElement(o.SquareGrid.Card,{key:e},r.a.createElement(o.SelectableCard,{id:e,formName:"telegraf-plugins",label:e,testID:`telegraf-plugins--${e}`,selected:this.isCardChecked(e),onClick:this.handleToggle,icon:o.IconFont.Checkmark},Object(s.createElement)(d.a[e]))))),this.emptyState)}get selectedBucketID(){const{buckets:e,selectedBucketName:t}=this.props;return e.find(e=>e.name===t).id}get emptyState(){const{searchTerm:e}=this.state,t=0===this.filteredBundles.length;if(e&&t)return r.a.createElement(o.EmptyState,{size:o.ComponentSize.Medium},r.a.createElement(o.EmptyState.Text,null,"No plugins match your search"))}get filteredBundles(){const{searchTerm:e}=this.state;return d.b.filter(t=>t.toLowerCase().includes(e.toLowerCase()))}isCardChecked(e){const{pluginBundles:t}=this.props;return!!t.find(t=>t===e)}};var h=m=Object(n.a)([l.a,Object(n.b)("design:paramtypes",[Object])],m),p=a(287),f=a(177),C=a(370);let b=class extends s.PureComponent{constructor(){super(...arguments),this.handleSelectBucket=e=>{const{orgID:t,id:a,name:n}=e;this.props.onSetBucketInfo(t,n,a)},this.handleTogglePluginBundle=(e,t)=>{t?this.props.onRemovePluginBundle(e):this.props.onAddPluginBundle(e)}}render(){return r.a.createElement(o.Form,{onSubmit:this.props.onIncrementCurrentStepIndex,className:"data-loading--form"},r.a.createElement(o.DapperScrollbars,{autoHide:!1,className:"data-loading--scroll-content"},r.a.createElement("div",null,r.a.createElement("h3",{className:"wizard-step--title"},"What do you want to monitor?"),r.a.createElement("h5",{className:"wizard-step--sub-title"},"Telegraf is a plugin-based data collection agent which writes metrics to a bucket in InfluxDB")),!!this.props.bucket&&r.a.createElement(h,{pluginBundles:this.props.pluginBundles,telegrafPlugins:this.props.telegrafPlugins,onTogglePluginBundle:this.handleTogglePluginBundle,buckets:this.props.buckets,selectedBucketName:this.props.bucket,onSelectBucket:this.handleSelectBucket}),r.a.createElement("h5",{className:"wizard-step--sub-title"},"Looking for other things to monitor? Check out our 200+ other  ",r.a.createElement("a",{href:"https://v2.docs.influxdata.com/v2.0/reference/telegraf-plugins/#input-plugins",target:"_blank"},"Telegraf Plugins"),"  and how to  ",r.a.createElement("a",{href:"https://v2.docs.influxdata.com/v2.0/write-data/no-code/use-telegraf/manual-config/",target:"_blank"},"Configure these Plugins"))),r.a.createElement(p.a,{autoFocusNext:!0,nextButtonStatus:this.nextButtonStatus,className:"data-loading--button-container"}))}get nextButtonStatus(){const{telegrafPlugins:e,buckets:t}=this.props;return t&&t.length&&e.length?o.ComponentStatus.Default:o.ComponentStatus.Disabled}};b=Object(n.a)([l.a],b);const E={onAddPluginBundle:f.b,onRemovePluginBundle:f.g,onSetBucketInfo:C.d};var S=Object(i.c)(({dataLoading:{dataLoaders:{telegrafPlugins:e,pluginBundles:t},steps:{bucket:a}}})=>({telegrafPlugins:e,bucket:a,pluginBundles:t}),E)(b),v=a(6),T=a.n(v),k=a(420);const P=350;class N extends s.PureComponent{constructor(e){super(e),this.handleChange=e=>{const{onChange:t}=this.props,{value:a}=e.target;t(e),this.debouncedValidate(a)},this.handleValidateURI=e=>{Object(k.a)(e)?this.setState({status:o.ComponentStatus.Valid}):this.setState({status:o.ComponentStatus.Error})},this.state={status:o.ComponentStatus.Default},this.debouncedValidate=T.a.debounce(this.handleValidateURI,P)}render(){const{name:e,value:t,autoFocus:a,helpText:n}=this.props;return r.a.createElement(o.Grid,null,r.a.createElement(o.Grid.Row,null,r.a.createElement(o.Grid.Column,{widthXS:o.Columns.Eight,offsetXS:o.Columns.Two},r.a.createElement(o.FormElement,{label:e,key:e,errorMessage:this.errorMessage,helpText:n},r.a.createElement(o.Input,{name:e,autoFocus:a,status:this.state.status,onChange:this.handleChange,size:o.ComponentSize.Medium,value:t})))))}get errorMessage(){const{status:e}=this.state;if(e===o.ComponentStatus.Error)return"Must be a valid URI."}}var F=N,D=a(61),w=a(5);class x extends s.PureComponent{constructor(){super(...arguments),this.handleAddRow=e=>{this.props.addTagValue(e,this.props.fieldName)},this.handleRemoveRow=e=>{const{removeTagValue:t,fieldName:a}=this.props;t(e,a)},this.handleEditRow=(e,t)=>{const{onSetConfigArrayValue:a,telegrafPluginName:n,fieldName:s}=this.props;a(n,s,e,t)}}render(){const{fieldName:e,autoFocus:t,helpText:a}=this.props;return r.a.createElement("div",{className:"multiple-input-index"},r.a.createElement(D.i,{title:e,helpText:a,inputType:this.inputType,autoFocus:t,onAddRow:this.handleAddRow,onDeleteRow:this.handleRemoveRow,onEditRow:this.handleEditRow,tags:this.tags}))}get inputType(){switch(this.props.fieldType){case w.ConfigFieldType.Uri:case w.ConfigFieldType.UriArray:return D.h.URI;case w.ConfigFieldType.String:case w.ConfigFieldType.StringArray:return D.h.String}}get tags(){const{value:e}=this.props;return e.map(e=>({text:e,name:e}))}}var I=x,y=a(147);class B extends s.PureComponent{render(){const{fieldType:e,fieldName:t,onChange:a,value:n,onSetConfigArrayValue:s,telegrafPluginName:i}=this.props;switch(e){case y.c.Uri:return r.a.createElement(F,{name:t,key:name,autoFocus:this.autoFocus,onChange:a,value:n,helpText:this.optionalText});case y.c.UriArray:case y.c.StringArray:return r.a.createElement(I,{fieldName:t,fieldType:e,addTagValue:this.props.addTagValue,removeTagValue:this.props.removeTagValue,autoFocus:this.autoFocus,value:n,helpText:this.optionalText,onSetConfigArrayValue:s,telegrafPluginName:i});case y.c.String:return r.a.createElement(o.Grid,null,r.a.createElement(o.Grid.Row,null,r.a.createElement(o.Grid.Column,{widthXS:o.Columns.Eight,offsetXS:o.Columns.Two},r.a.createElement(o.Form.Element,{label:t,key:t,helpText:this.optionalText},r.a.createElement(o.Input,{name:t,autoFocus:this.autoFocus,onChange:a,size:o.ComponentSize.Medium,value:n})))));default:return r.a.createElement("div",null)}}get optionalText(){return this.props.isRequired?"":"optional"}get autoFocus(){const{index:e}=this.props;return 0===e}}var j=B;class z extends s.PureComponent{constructor(){super(...arguments),this.handleAddConfigFieldValue=(e,t)=>{const{onAddConfigValue:a,telegrafPlugin:n}=this.props;a(n.name,t,e)},this.handleRemoveConfigFieldValue=(e,t)=>{const{onRemoveConfigValue:a,telegrafPlugin:n}=this.props;a(n.name,t,e)},this.handleUpdateConfigField=e=>{const{onUpdateTelegrafPluginConfig:t,telegrafPlugin:a}=this.props,{name:n,value:s}=e.target;t(a.name,n,s)}}render(){return r.a.createElement("div",null,this.formFields)}get formFields(){const{configFields:e,telegrafPlugin:t,onSetConfigArrayValue:a}=this.props;return e?Object.entries(e).map(([e,{type:n,isRequired:s}],i)=>r.a.createElement(j,{key:e,fieldName:e,fieldType:n,index:i,onChange:this.handleUpdateConfigField,value:this.getFieldValue(t,e,n),isRequired:s,addTagValue:this.handleAddConfigFieldValue,removeTagValue:this.handleRemoveConfigFieldValue,onSetConfigArrayValue:a,telegrafPluginName:t.name})):r.a.createElement("p",{"data-testid":"no-config"},"No configuration required.")}getFieldValue(e,t,a){let n;return n=a===y.c.String||a===y.c.Uri?"":[],T.a.get(e,`plugin.config.${t}`,n)}}const O={onUpdateTelegrafPluginConfig:f.o,onAddConfigValue:f.a,onRemoveConfigValue:f.f,onSetConfigArrayValue:f.i};var V=Object(i.c)(null,O)(z);class L extends s.PureComponent{constructor(){super(...arguments),this.handleSubmitForm=()=>{const{telegrafPlugins:e,onSetPluginConfiguration:t,onSetActiveTelegrafPlugin:a}=this.props,n=e.find(e=>e.active);if(n){if(!n.hasOwnProperty("plugin"))return void a("");t(n.name)}a("")}}render(){const{configFields:e,telegrafPlugin:t}=this.props;return r.a.createElement(o.Form,{onSubmit:this.handleSubmitForm,className:"data-loading--form"},r.a.createElement(o.DapperScrollbars,{autoHide:!1,className:"data-loading--scroll-content"},r.a.createElement("div",null,r.a.createElement("h3",{className:"wizard-step--title"},T.a.startCase(t.name)),r.a.createElement("h5",{className:"wizard-step--sub-title"},"For more information about this plugin, see"," ",r.a.createElement("a",{target:"_blank","data-testid":"docs-link",href:`https://github.com/influxdata/telegraf/tree/master/plugins/inputs/${t.name}`},"Documentation"))),r.a.createElement(V,{configFields:e,telegrafPlugin:t})),r.a.createElement(p.a,{autoFocusNext:this.autoFocus,nextButtonText:"Done",className:"data-loading--button-container"}))}get autoFocus(){const{configFields:e}=this.props;return!e}}const R={onSetActiveTelegrafPlugin:f.h,onSetPluginConfiguration:f.k};var A=Object(i.c)(({dataLoading:{dataLoaders:{telegrafPlugins:e}}})=>({telegrafPlugins:e}),R)(L);class U extends s.PureComponent{render(){return r.a.createElement("div",null,"Must select a data source.")}}var M=U,G=a(418),_=a(22),$=a.n(_);class q extends s.Component{constructor(){super(...arguments),this.handleClick=()=>{const{id:e,onClick:t}=this.props;t(e)}}render(){const{label:e}=this.props;return r.a.createElement("div",{className:this.className,onClick:this.handleClick},r.a.createElement("pre",null,this.icon," ",e))}get className(){const{status:e,active:t}=this.props;return $()("side-bar--tab",{active:t,"side-bar--tab__success":e===J.Success,"side-bar--tab__error":e===J.Error,"side-bar--tab__pending":e===J.Pending})}get icon(){const{status:e}=this.props;switch(e){case J.Pending:case J.Success:return r.a.createElement(o.Icon,{glyph:o.IconFont.Checkmark});case J.Error:return r.a.createElement(o.Icon,{glyph:o.IconFont.Remove});default:return r.a.createElement(o.Icon,{glyph:o.IconFont.CircleThick})}}}var H=q;class X extends s.Component{render(){const{text:e,titleText:t,color:a,onClick:n,icon:s}=this.props;return r.a.createElement(o.Button,{className:"side-bar--button",text:e,titleText:t,onClick:n,size:o.ComponentSize.Small,color:a,icon:s})}}var J,W=X;!function(e){e.Default="default",e.Error="error",e.Success="success",e.Pending="pending",e.Blank="blank"}(J||(J={}));class K extends s.Component{render(){const{title:e}=this.props;return r.a.createElement("div",{className:this.containerClassName},r.a.createElement("div",{className:"side-bar--container"},r.a.createElement("h3",{className:"side-bar--title"},e),r.a.createElement(o.DapperScrollbars,{autoHide:!1},r.a.createElement("div",{className:"side-bar--tabs"},this.childTabs))))}get containerClassName(){const{visible:e}=this.props;return $()("side-bar",{show:e})}get childTabs(){const{children:e}=this.props;return r.a.Children.map(e,e=>{if(e.type===H)return e})}}K.Tab=H,K.Button=W;var Q=K;const Y=e=>{switch(e){case y.d.Unconfigured:return J.Default;case y.d.InvalidConfiguration:return J.Error;case y.d.Configured:return J.Success}};class Z extends s.Component{render(){const{title:e,visible:t}=this.props;return r.a.createElement(Q,{title:e,visible:t},this.tabs)}get tabs(){const{telegrafPlugins:e,onTabClick:t}=this.props;return e.map(e=>r.a.createElement(Q.Tab,{label:e.name,key:e.name,id:e.name,active:e.active,status:Y(e.configured),onClick:t}))}}var ee=Z,te=a(28),ae=a(168),ne=a(31),se=a(512),re=a(21),ie=a(878);class oe extends s.PureComponent{constructor(){super(...arguments),this.handleFormSubmit=()=>{const{onSaveTelegrafConfig:e,telegrafConfigID:t}=this.props;e(),t||this.handleCreateDashboardsForPlugins(),this.props.onIncrementStep()},this.handleNameInput=e=>{this.props.onSetTelegrafConfigName(e.target.value)},this.handleDescriptionInput=e=>{this.props.onSetTelegrafConfigDescription(e.target.value)},this.handleClickSideBarTab=e=>{const{onSetActiveTelegrafPlugin:t,telegrafPlugins:a,onSetPluginConfiguration:n}=this.props,s=a.find(e=>e.active);s&&n(s.name),t(e)}}render(){const{telegrafConfigName:e,telegrafConfigDescription:t,telegrafPlugins:a,onDecrementStep:n}=this.props;return r.a.createElement(o.Form,{onSubmit:this.handleFormSubmit,className:"data-loading--form"},r.a.createElement("div",{className:"data-loading--scroll-content"},r.a.createElement("div",null,r.a.createElement("h3",{className:"wizard-step--title"},"Configure Plugins"),r.a.createElement("h5",{className:"wizard-step--sub-title"},"Configure each plugin from the menu on the left. Some plugins do not require any configuration.")),r.a.createElement("div",{className:"data-loading--columns"},r.a.createElement(ee,{telegrafPlugins:a,onTabClick:this.handleClickSideBarTab,title:"Plugins",visible:this.sideBarVisible}),r.a.createElement("div",{className:"data-loading--column-panel"},r.a.createElement(o.DapperScrollbars,{autoHide:!1,className:"data-loading--scroll-content"},r.a.createElement(o.Form.Element,{label:"Telegraf Configuration Name"},r.a.createElement(o.Input,{type:o.InputType.Text,value:e,name:"name",onChange:this.handleNameInput,titleText:"Telegraf Configuration Name",size:o.ComponentSize.Medium,autoFocus:!0})),r.a.createElement(o.Form.Element,{label:"Telegraf Configuration Description"},r.a.createElement(o.Input,{type:o.InputType.Text,value:t,name:"description",onChange:this.handleDescriptionInput,titleText:"Telegraf Configuration Description",size:o.ComponentSize.Medium})))))),r.a.createElement(p.a,{onClickBack:n,nextButtonText:"Create and Verify",className:"data-loading--button-container"}))}async handleCreateDashboardsForPlugins(){const{notify:e,telegrafPlugins:t,orgID:a}=this.props;try{const n=t.filter(e=>e.configured===w.ConfigurationState.Configured).map(e=>e.templateID).filter(e=>e),s=se.a.filter(e=>Object(v.includes)(n,Object(v.get)(e,"meta.templateID"))),r=s.map(e=>Object(ae.a)(e,a)),i=s.map(e=>e.meta.name.toLowerCase());(await Promise.all(r)).length&&e(Object(ne.j)(i))}catch(t){e(Object(ne.k)())}}get sideBarVisible(){const{telegrafPlugins:e}=this.props;return e.length>0}}const le={onSetTelegrafConfigName:f.n,onSetTelegrafConfigDescription:f.l,onIncrementStep:C.c,onDecrementStep:C.b,onSetActiveTelegrafPlugin:f.h,onSetPluginConfiguration:f.k,onSaveTelegrafConfig:f.d,notify:te.c};var ce=Object(i.c)(e=>{const{telegrafConfigName:t,telegrafConfigDescription:a,telegrafPlugins:n,telegrafConfigID:s}=Object(ie.a)(e),{id:r}=Object(re.a)(e);return{telegrafConfigName:t,telegrafConfigDescription:a,telegrafPlugins:n,telegrafConfigID:s,orgID:r}},le)(oe);class ue extends s.PureComponent{render(){const{telegrafPlugins:e}=this.props;return this.activeTelegrafPlugin?r.a.createElement(A,{telegrafPlugin:this.activeTelegrafPlugin,configFields:this.configFields}):e&&e.length?r.a.createElement(ce,null):r.a.createElement(M,null)}get activeTelegrafPlugin(){const{telegrafPlugins:e}=this.props;return e.find(e=>e.active)}get configFields(){if(this.activeTelegrafPlugin)return Object(G.b)(this.activeTelegrafPlugin.name)}}var de,ge=Object(i.c)(({dataLoading:{dataLoaders:{telegrafPlugins:e}}})=>({telegrafPlugins:e}))(ue),me=a(895),he=a(70),pe=a(121);!function(e){e.NotStarted="NotStarted",e.Loading="Loading",e.Done="Done",e.NotFound="NotFound",e.Error="Error"}(de||(de={}));let fe=class extends s.PureComponent{render(){return r.a.createElement("div",null,r.a.createElement("h4",{className:`wizard-step--text-state ${this.className}`},this.header),r.a.createElement("p",null,this.additionalText))}get className(){switch(this.props.loading){case de.Loading:return"loading";case de.Done:return"success";case de.NotFound:case de.Error:return"error"}}get header(){switch(this.props.loading){case de.Loading:return"Awaiting Connection...";case de.Done:return"Connection Found!";case de.NotFound:return"Data Not Found";case de.Error:return"Error Listening for Data"}}get additionalText(){switch(this.props.loading){case de.Loading:return`Timeout in ${this.props.countDownSeconds} seconds`;case de.Done:return`${this.props.bucket} is receiving data loud and clear!`;case de.NotFound:case de.Error:return"Check config and try again"}}};var Ce=fe=Object(n.a)([l.a],fe);let be=class extends s.PureComponent{constructor(e){super(e),this.handleClick=()=>{this.startTimer(),this.setState({loading:de.Loading}),this.startTime=Number(new Date),this.checkForData()},this.checkForData=async()=>{const{bucket:e,match:{params:{orgID:t}}}=this.props,{secondsLeft:a}=this.state,n=`from(bucket: "${e}")\n      |> range(start: -1m)`;let s,r;try{const e=await Object(pe.a)(t,n).promise;if("SUCCESS"!==e.type)throw new Error(e.message);s=e.csv.length,r=Number(new Date)-this.startTime}catch(e){return void this.setState({loading:de.Error})}s>1?this.setState({loading:de.Done}):r>=6e4||a<=0?this.setState({loading:de.NotFound}):this.intervalID=setTimeout(()=>{this.checkForData()},5e3)},this.countDown=()=>{const{secondsLeft:e}=this.state,t=e-1;this.setState({timePassedInSeconds:60-t,secondsLeft:t}),0===t&&clearInterval(this.timer)},this.state={loading:de.NotStarted,timePassedInSeconds:0,secondsLeft:60}}componentWillUnmount(){clearInterval(this.intervalID),clearInterval(this.timer),this.setState({timePassedInSeconds:0,secondsLeft:60})}render(){return r.a.createElement("div",{className:"wizard-step--body-streaming","data-testid":"streaming"},this.connectionInfo,this.listenButton)}get connectionInfo(){const{loading:e}=this.state;if(e!==de.NotStarted)return r.a.createElement(Ce,{loading:this.state.loading,bucket:this.props.bucket,countDownSeconds:this.state.secondsLeft})}get listenButton(){const{loading:e}=this.state;if(e!==de.Loading&&e!==de.Done)return r.a.createElement(o.Button,{color:o.ComponentColor.Primary,text:"Listen for Data",size:o.ComponentSize.Medium,onClick:this.handleClick,status:o.ComponentStatus.Default,titleText:"Listen for Data"})}startTimer(){this.setState({timePassedInSeconds:0,secondsLeft:60}),this.timer=setInterval(this.countDown,1e3)}};be=Object(n.a)([l.a,Object(n.b)("design:paramtypes",[Object])],be);var Ee=Object(he.j)(be);let Se=class extends s.PureComponent{render(){const{token:e,configID:t,bucket:a}=this.props;return r.a.createElement("div",{className:"streaming"},r.a.createElement(me.a,{token:e,configID:t}),r.a.createElement(Ee,{bucket:a}))}};var ve=Se=Object(n.a)([l.a],Se);let Te=class extends s.PureComponent{render(){const{telegrafConfigID:e,bucket:t,org:a,onDecrementCurrentStepIndex:n,onExit:s,token:i}=this.props;return r.a.createElement(o.Form,{onSubmit:s,className:"data-loading--form"},r.a.createElement(o.DapperScrollbars,{autoHide:!1,className:"data-loading--scroll-content"},r.a.createElement("div",null,r.a.createElement("h3",{className:"wizard-step--title"},"Test your Configuration"),r.a.createElement("h5",{className:"wizard-step--sub-title"},"Start Telegraf and ensure data is being written to InfluxDB")),r.a.createElement(ve,{org:a,bucket:t,token:i,configID:e})),r.a.createElement(p.a,{onClickBack:n,nextButtonText:"Finish",className:"data-loading--button-container"}))}};Te=Object(n.a)([l.a],Te);var ke=Object(i.c)(({dataLoading:{dataLoaders:{telegrafConfigID:e,token:t},steps:{bucket:a,org:n}},me:{name:s}})=>({username:s,telegrafConfigID:e,bucket:a,org:n,token:t}))(Te);let Pe=class extends s.PureComponent{render(){const{stepProps:e,buckets:t}=this.props;switch(e.currentStepIndex){case y.b.Select:return r.a.createElement(S,Object.assign({},e,{buckets:t}));case y.b.Configure:return r.a.createElement(ge,null);case y.b.Verify:return r.a.createElement(ke,Object.assign({},e));default:return r.a.createElement("div",null)}}};Pe=Object(n.a)([l.a],Pe);t.default=Pe}}]);
//# sourceMappingURL=static/69.d226342274.js.map